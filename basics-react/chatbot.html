<html>
    <head>
        <title>ChatBot</title>
        <style>
            body{
                font-family: Arial, sans-serif;
                margin-top: 0px;
                margin-bottom: 0px;
                margin: 0; height: 100%;

            }
            .chat-input{
                font-size: 16px;
                padding: 12px 15px;
                margin-right: 8px;
                border-radius: 10px;
                flex-grow:1
            }
            button{
                font-size: 16px;
                padding: 12px 20px;
                background-color: green;
                color: white;
                margin-left:10px;
                border: none;
                border-radius: 10px;
                cursor: pointer;
            }
            .chat-input-container{
                display: flex;
                margin-bottom: 60px;

            }
            .app-container{

                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
                height: 100vh;
                display: flex;
                flex-direction: column;
    
            }
            .user-message{
                display: flex;
                justify-content: end;
            }
            .robot-message{
                display: flex;
            }
            .message-text{
                background-color: rgb(238, 238, 238);
                padding: 15px 20px;
                border-radius: 10px;
                margin-right: 10px;
                margin-left: 10px;
                margin-bottom: 20px;
            }
            .chat-messages-container{
                flex-grow: 1;
                margin-top:20px;
                overflow:  scroll;
                scrollbar-width: none;
                
            }
            img{
                vertical-align: middle;
                margin: 0 8px;
            }
            </style>
    </head>
    <body>
        <div class="js-container"></div>

        <script src="https://unpkg.com/supersimpledev/react.js"></script>
        <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
        <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
        <script src="https://unpkg.com/supersimpledev/babel.js"></script>
        <script type="text/babel">
            function ChatInput({chatProps,setChatProps}){
                const [inputText,setInputText]=React.useState('');

                function saveInputText(event){
                    setInputText(event.target.value);
                }
                async function sendMessage(){
                    const newChatMessages = [
                        ...chatProps,
                        {
                            messages: inputText,
                            sender:'user',
                            id: crypto.randomUUID()

                        },
                        {
                            message: 'Loading...',
                            sender: 'robot',
                             id: crypto.randomUUID()
                     }
                    ]
                    setChatProps(newChatMessages);
                    setInputText('');
                    const response = await chatbot.getResponseAsync(inputText)
                    setChatProps(()=>[
                        ...newChatMessages.slice(0, newChatMessages.length - 1),
                        {
                            messages: response,
                            sender:'robot',
                            id: crypto.randomUUID()
                        }
                    ]); 
                }
                function keyDown(event){
                    if(event.key ==='Enter'){
                        sendMessage()
                    }
                    else if(event.key==='Escape'){
                        setInputText('');
                    }
                }

                return(
                    <div class="chat-input-container">
                        <input 
                            placeholder="Send Message to Chatbot"  
                            size="30"
                            onChange={saveInputText}
                            onKeyDown={keyDown}
                            value={inputText}
                            className="chat-input"
                        />
                        <button onClick={sendMessage}>Send</button>
                    </div>
                )
            }
            function ChatMessage({message,sender,id}){
                return(
                    <div className={sender === "robot" ? "robot-message" : "user-message"}>
                        {sender === "robot" && 
                            <img src="robot.png" width="50" height="50"/>}
                        <div className="message-text">
                            {message}
                        </div>
                        {sender==='user' &&
                            <img src="user.png" width="50" height="50"/>}
                     </div>
                )
            }
            function ChatMessages({chatProps}){
                const chatMessagesRef = React.useRef( null)
                React.useEffect(()=>{
                    const conatinerElem=chatMessagesRef.current
                    if(conatinerElem){
                        conatinerElem.scrollTop=conatinerElem.scrollHeight;
                    }
                },[chatProps]);
                return(
                    <div className="chat-messages-container"
                    ref={chatMessagesRef}>
                    { chatProps.map((chat)=>{
                            return(
                                <ChatMessage
                                   message={chat.messages}
                                   sender={chat.sender}
                                   key={chat.id}
                                />
                            )
                        })}
                    </div>
                )
            }
            function App(){
                
            }
            const container = document.querySelector('.js-container');
            ReactDOM.createRoot(container).render(<App />);
        </script>     
    </body>
</html>